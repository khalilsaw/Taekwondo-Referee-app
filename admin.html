<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Admin</title>
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.2/font/bootstrap-icons.css"
    />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65"
      crossorigin="anonymous"
    />
  </head>

  <body class="p-3 mb-2 bg-secondary text-white">
    <style>
      body {
        position: relative;
        text-align: center;
        min-height: 100vh;
      }

      .content {
        position: absolute;
        text-align: center;
        margin: -10px 0 0 -30px;
        top: 70%;
        left: 50%;
        font-size: 20px;
      }
    </style>

    <!-- TEsting buble -->

    <nav class="navbar bg-light">
      <div class="container">
        <a class="navbar-brand" href="#">
          <img src="/img/logo.png" alt="Bootstrap" width="120" height="auto" />
        </a>
        <a>
          <img src="/img/logo3.png" alt="Bootstrap" width="250" />
        </a>
        <a class="navbar-brand" href="#">
          <form id="round-form">
            <label for="round-select">Select a round:</label>
            <br />
            <select id="round-select" class="form-select form-select-lg mb-3">
              <option value="1">Round 1</option>
              <option value="2">Round 2</option>
              <option value="3">Round 3</option>
            </select>
            <button
              type="submit"
              id="gogo"
              class="btn btn-secondary"
              style="width: 14rem"
            >
              Go
            </button>
          </form>
        </a>
        <a class="navbar-brand" href="#">
          <span id="timer" style="font-size: 6rem">02:00</span>
        </a>
        <a class="navbar-brand" href="#">
          <button
            class="btn btn-secondary btn-lg"
            type="button"
            id="start-resume-button"
          >
            <i class="bi bi-play-fill"></i>
          </button>
          <button
            class="btn btn-secondary btn-lg"
            type="button"
            id="pause-button"
          >
            <i class="bi bi-pause-fill"></i>
          </button>
          <button
            class="btn btn-secondary btn-lg"
            type="button"
            id="restart-button"
          >
            <i class="bi bi-arrow-clockwise"></i>
          </button>
        </a>
        <button class="btn btn-secondary btn-lg" onclick="tv()">TV</button>
        <a class="navbar-brand" href="#">
          <img src="/img/logo2.png" alt="Bootstrap" width="120" height="auto" />
        </a>
      </div>
    </nav>
    <br />
    <section
      id="alert-container"
      style="font-size: 60px; font-family: monospace; text-align: center"
    ></section>

    <hr />
    <div class="container text-center">
      <div class="row">
        <div class="col">
          <div class="card-header" style="max-width: 9rem">Arbitre 1</div>
        </div>
        <div class="col">
          <div class="card-header" style="max-width: 9rem">Arbitre 2</div>
        </div>
        <div class="col">
          <div class="card-header" style="max-width: 9rem">Arbitre 3</div>
        </div>
        <div class="col">
          <div class="card-header" style="max-width: 9rem">Arbitre 4</div>
        </div>
        <div class="col">
          <div class="card-header" style="max-width: 9rem">Arbitre 5</div>
        </div>
        <div class="col hyr">
          <button
            type="button"
            id="hehoclicke"
            class="btn btn-secondary card-header"
            style="
              width: 200px;
              background-color: lightgray;
              color: #000;
              padding: 10px;
              border: none;
              margin-bottom: 10px;
              border-radius: 10px;
            "
          >
            Resulta :
          </button>
        </div>
      </div>
      <!--round 1-->
      <div class="row">
        <div class="col">
          <div
            class="card"
            id="A1R1"
            style="max-width: 9rem; height: 4rem; background-color: gray"
          >
            <p
              id="card1 "
              class="card-assigned-value-round1"
              style="font-size: 40px"
            >
              0
            </p>
          </div>
        </div>
        <div class="col">
          <div
            class="card"
            id="A2R1"
            style="max-width: 9rem; height: 4rem; background-color: gray"
          >
            <p
              id="card1 "
              class="card-assigned-value-round1"
              style="font-size: 40px"
            >
              0
            </p>
          </div>
        </div>
        <div class="col">
          <div
            class="card"
            id="A3R1"
            style="max-width: 9rem; height: 4rem; background-color: gray"
          >
            <p
              id="card2 "
              class="card-assigned-value-round1"
              style="font-size: 40px"
            >
              0
            </p>
          </div>
        </div>
        <div class="col">
          <div
            class="card"
            id="A4R1"
            style="max-width: 9rem; height: 4rem; background-color: gray"
          >
            <p
              id="card4 "
              class="card-assigned-value-round1"
              style="font-size: 40px"
            >
              0
            </p>
          </div>
        </div>
        <div class="col">
          <div
            class="card"
            id="A5R1"
            style="max-width: 9rem; height: 4rem; background-color: gray"
          >
            <p
              id="card5"
              class="card-assigned-value-round1"
              style="font-size: 40px"
            >
              0
            </p>
          </div>
        </div>
        <div class="col">
          <div
            class="card"
            id="roundwith1"
            style="max-width: 14rem; height: 4rem; background-color: gray"
          >
            -
          </div>
        </div>
      </div>
      <!--round 2-->
      <div class="row">
        <div class="col">
          <div
            class="card"
            id="A1R2"
            style="max-width: 9rem; height: 4rem; background-color: gray"
          >
            <p
              id="card1 "
              class="card-assigned-value-round2"
              style="font-size: 40px"
            >
              0
            </p>
          </div>
        </div>
        <div class="col">
          <div
            class="card"
            id="A2R2"
            style="max-width: 9rem; height: 4rem; background-color: gray"
          >
            <p
              id="card2 "
              class="card-assigned-value-round2"
              style="font-size: 40px"
            >
              0
            </p>
          </div>
        </div>
        <div class="col">
          <div
            class="card"
            id="A3R2"
            style="max-width: 9rem; height: 4rem; background-color: gray"
          >
            <p
              id="card3 "
              class="card-assigned-value-round2"
              style="font-size: 40px"
            >
              0
            </p>
          </div>
        </div>
        <div class="col">
          <div
            class="card"
            id="A4R2"
            style="max-width: 9rem; height: 4rem; background-color: gray"
          >
            <p
              id="card4"
              class="card-assigned-value-round2"
              style="font-size: 40px"
            >
              0
            </p>
          </div>
        </div>
        <div class="col">
          <div
            class="card"
            id="A5R2"
            style="max-width: 9rem; height: 4rem; background-color: gray"
          >
            <p
              id="card5 "
              class="card-assigned-value-round2"
              style="font-size: 40px"
            >
              0
            </p>
          </div>
        </div>
        <div class="col">
          <div
            class="card"
            id="roundwith2"
            style="max-width: 14rem; height: 4rem; background-color: gray"
          >
            -
          </div>
        </div>
      </div>
      <!--round 3-->
      <div class="row">
        <div class="col">
          <div
            class="card"
            id="A1R3"
            style="max-width: 9rem; height: 4rem; background-color: gray"
          >
            <p
              id="card1 "
              class="card-assigned-value-round3"
              style="font-size: 40px"
            >
              0
            </p>
          </div>
        </div>
        <div class="col">
          <div
            class="card"
            id="A2R3"
            style="max-width: 9rem; height: 4rem; background-color: gray"
          >
            <p
              id="card2 "
              class="card-assigned-value-round3"
              style="font-size: 40px"
            >
              0
            </p>
          </div>
        </div>
        <div class="col">
          <div
            class="card"
            id="A3R3"
            style="max-width: 9rem; height: 4rem; background-color: gray"
          >
            <p
              id="card3 "
              class="card-assigned-value-round3"
              style="font-size: 40px"
            >
              0
            </p>
          </div>
        </div>
        <div class="col">
          <div
            class="card"
            id="A4R3"
            style="max-width: 9rem; height: 4rem; background-color: gray"
          >
            <p
              id="card4 "
              class="card-assigned-value-round3"
              style="font-size: 40px"
            >
              0
            </p>
          </div>
        </div>
        <div class="col">
          <div
            class="card"
            id="A5R3"
            style="max-width: 9rem; height: 4rem; background-color: gray"
          >
            <p
              id="card5 "
              class="card-assigned-value-round3"
              style="font-size: 40px"
            >
              0
            </p>
          </div>
        </div>
        <div class="col">
          <div
            class="card"
            id="roundwith3"
            style="max-width: 14rem; height: 4rem; background-color: gray"
          >
            -
          </div>
        </div>
      </div>
    </div>

    <hr />
    <div class="container text-center">
      <div class="row">
        <div class="col text-bg-primary" style="font-size: 2rem; height: 12rem">
          <label for="bleuplayer" class="form-label">bleu player</label>
          <input
            type="text"
            class="form-control form-control-lg"
            id="bleuplayer"
            placeholder="le nom de bleu player"
          />
          <h5>Association</h5>
          <input
            type="text"
            class="form-control form-control-lg"
            id="bleuplayerassociation"
            placeholder="le nom de association"
          />
        </div>
        <div class="col col-3">
          <h3>Les catégories :</h3>
          <input
            id="categories"
            type="text"
            class="form-control"
            placeholder="Weight"
            style="margin-bottom: 20px"
          />
          <div class="row">
            <div class="col">
              <input
                type="radio"
                class="btn-check"
                name="options-outlined"
                id="men"
                value="men"
                autocomplete="off"
              />
              <label
                class="btn btn-outline-dark"
                for="men"
                style="font-size: 30px"
              >
                &nbsp;&nbsp;&nbsp;Men&nbsp;&nbsp;&nbsp;
              </label>
            </div>
            <div class="col">
              <input
                type="radio"
                class="btn-check"
                name="options-outlined"
                id="women"
                value="women"
                autocomplete="off"
              />
              <label
                class="btn btn-outline-dark"
                for="women"
                style="font-size: 30px"
              >
                Women
              </label>
            </div>
          </div>
          <div class="row">
            <div class="col">
              <div
                id="tv-player-redirection"
                class="btn btn-dark"
                style="margin: 10px; width: 14rem"
              >
                Go
              </div>
            </div>
          </div>
        </div>
        <div class="col text-bg-danger" style="font-size: 2rem; height: 12rem">
          <label for="redplayer" class="form-label">Red player</label>
          <input
            type="text"
            class="form-control form-control-lg"
            id="redplayer"
            placeholder="le nom de Rouge player"
          />
          <h5>Association</h5>
          <input
            type="text"
            class="form-control form-control-lg"
            id="redplayerassociation"
            placeholder="le nom de association"
          />
          <h7 style="font-size: 2px">&nbsp;</h7>
        </div>
      </div>
    </div>

    <div class="container text-center">
      <div class="row align-items-start">
        <div class="col text-bg-primary">
          <h3>Cart pour Bleu</h3>
          <button
            class="btn btn-primary"
            type="button"
            onclick="incrementCardValueBlue('out')"
          >
            <img
              src="/img/out.png"
              style="
                width: 80px;
                height: 90px;
                margin-top: 15px;
                margin-bottom: 15px;
              "
            />
          </button>
          &nbsp;
          <button
            class="btn btn-primary"
            type="button"
            onclick="incrementCardValueBlue('yellow')"
          >
            <i
              class="bi bi-file-earmark-fill"
              style="font-size: 5rem; color: yellow"
            ></i>
          </button>
          &nbsp;
          <button
            class="btn btn-primary"
            type="button"
            onclick="incrementCardValueBlue('blue')"
          >
            <i
              class="bi bi-file-earmark-fill"
              style="font-size: 5rem; color: blue"
            ></i>
          </button>
          &nbsp;
          <button
            class="btn btn-primary"
            type="button"
            onclick="incrementCardValueBlue('red')"
          >
            <i
              class="bi bi-file-earmark-fill"
              style="font-size: 5rem; color: red"
            ></i>
          </button>
          &nbsp;
          <!-- <button
            class="btn btn-primary"
            type="button"
            onclick="incrementCardValueBlue('countdown')"
          >
            <img
              src="/img/countdown.png"
              style="
                width: 80px;
                height: 90px;
                margin-top: 15px;
                margin-bottom: 15px;
              "
            />
          </button> -->
        </div>

        <div class="col text-bg-danger">
          <h3>Cart pour Rouge</h3>
          <button
            class="btn btn-danger"
            type="button"
            onclick="incrementCardValueRed('out')"
          >
            <img
              src="/img/out.png"
              style="
                width: 80px;
                height: 90px;
                margin-top: 15px;
                margin-bottom: 15px;
              "
            />
          </button>
          &nbsp;
          <button
            class="btn btn-danger"
            type="button"
            onclick="incrementCardValueRed('yellow')"
          >
            <i
              class="bi bi-file-earmark-fill"
              style="font-size: 5rem; color: yellow"
            ></i>
          </button>
          &nbsp;
          <button
            class="btn btn-danger"
            type="button"
            onclick="incrementCardValueRed('blue')"
          >
            <i
              class="bi bi-file-earmark-fill"
              style="font-size: 5rem; color: blue"
            ></i>
          </button>
          &nbsp;
          <button
            class="btn btn-danger"
            type="button"
            onclick="incrementCardValueRed('red')"
          >
            <i
              class="bi bi-file-earmark-fill"
              style="font-size: 5rem; color: red"
            ></i>
          </button>
          &nbsp;
          <!-- <button
            class="btn btn-danger"
            type="button"
            onclick="incrementCardValueRed('countdown')"
          >
            <img
              src="/img/countdown.png"
              style="
                width: 80px;
                height: 90px;
                margin-top: 15px;
                margin-bottom: 15px;
              "
            />
          </button> -->
        </div>
      </div>
      <div class="row">
        <div class="col text-bg-primary" style="font-size: 2rem">
          <span id="incrementValuecardout_playerbleu">0</span>
          <i class="bi bi-bootstrap-reboot"></i>
          &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
          <span id="incrementValuecardyellow_playerbleu">0</span>
          <i class="bi bi-bootstrap-reboot"></i>
          &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
          <span id="incrementValuecardbleu_playerbleu">0</span>
          <i class="bi bi-bootstrap-reboot"></i>
          &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
          <span id="incrementValuecardred_playerbleu">0</span>
          <i class="bi bi-bootstrap-reboot"></i>
        </div>

        <div class="col text-bg-danger" style="font-size: 2rem">
          <span id="incrementValuecardout_playerred">0</span>
          <i class="bi bi-bootstrap-reboot"></i>
          &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
          <span id="incrementValuecardyellow_playerred">0</span>
          <i class="bi bi-bootstrap-reboot"></i>
          &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
          <span id="incrementValuecardbleu_playerred">0</span>
          <i class="bi bi-bootstrap-reboot"></i>
          &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
          <span id="incrementValuecardred_playerred">0</span>
          <i class="bi bi-bootstrap-reboot"></i>
        </div>
      </div>
    </div>
    <hr />
    <div class="container text-center">
      <div class="row">
        <div class="col" style="font-size: 2rem">
          <h1>Winner :</h1>
          <button
            class="btn btn-primary btn-lg"
            id="redirect-button-blue"
            type="button"
          >
            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
            <i class="bi bi-person-fill" style="font-size: 4rem"></i>
            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
          </button>
          &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;

          <button
            class="btn"
            id="redirect-equal"
            style="background: linear-gradient(to right, blue 50%, red 50%)"
            type="button"
          >
            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;

            <i class="bi bi-arrow-left-right" style="font-size: 4rem"></i>

            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
          </button>

          &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;

          <button class="btn btn-danger btn-lg" type="button">
            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
            <i
              class="bi bi-person-fill"
              id="redirect-button-red"
              style="font-size: 4rem"
            ></i>
            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
          </button>
        </div>
      </div>
    </div>
    <!-- Modal -->
    <div
      class="modal fade"
      id="confirmation-modal"
      tabindex="-1"
      role="dialog"
      aria-labelledby="confirmation-modal-label"
      aria-hidden="true"
    >
      <div class="modal-dialog" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="confirmation-modal-label">
              Confirmation
            </h5>
            <button
              type="button"
              class="close"
              data-dismiss="modal"
              aria-label="Close"
            >
              <span aria-hidden="true">&times;</span>
            </button>
          </div>
          <div class="modal-body" style="color: #000">
            Are you sure you want to declare a winner?
          </div>
          <div class="modal-footer">
            <button
              type="button"
              class="btn btn-secondary btn-cancel"
              data-dismiss="modal"
            >
              Cancel
            </button>
            <button type="button" class="btn btn-primary btn-confirm">
              Confirm
            </button>
          </div>
        </div>
      </div>
    </div>
    <br />
    <br />
    <br />
    <br />
    <script src="/socket.io/socket.io.js"></script>
    <script>
      const socket = io();
      const arbitreIds = [];
      let pl1 = 0;
      let pl2 = 0;
      let resultro = 0;
      let bcount = 0;
      let rcount = 0;
      let timerInterval;
      let soundPlayedAlready = false;
      let soundPlayedAlready2 = false;
      let counterrsound = new Audio('/sound/countdown5s.mp3');
      let counterrsound2 = new Audio('/sound/countdown5s.mp3');
      let billsound = new Audio('/sound/bell.mp3');
      // Variable declarations
      let valueCardOutPlayerBlue = 0;
      let valueCardYellowPlayerBlue = 0;
      let valueCardBluePlayerBlue = 0;
      let valueCardRedPlayerBlue = 0;
      let valueCardCountdownPlayerBlue = 0;

      let valueCardOutPlayerRed = 0;
      let valueCardYellowPlayerRed = 0;
      let valueCardBluePlayerRed = 0;
      let valueCardRedPlayerRed = 0;
      let valueCardCountdownPlayerRed = 0;

      const url = new URL(window.location.href);
      const vurl = url.pathname.split('/')[0];
      const username = url.pathname.split('/')[1];
      const role = url.pathname.split('/')[2];
      const roomid = url.pathname.split('/')[3];

      socket.on('connect', () => {
        socket.emit('login', { username, role, roomid });
      });

      socket.emit('request-values');

      const values = {};

      socket.on('receive-values', (data) => {
        const receivedRound = data.round;
        const receivedArbitreName = data.arbitreName;
        const receivedWinner = data.winner;
        const receivedroomid = data.roomid;

        // Initialize the object for the received room ID if necessary
        if (!values[receivedroomid]) {
          values[receivedroomid] = {};
        }

        // Initialize the array for the received round number if necessary
        if (!values[receivedroomid][receivedRound]) {
          values[receivedroomid][receivedRound] = [];
        }

        // Push the received values into the corresponding array based on the round number
        values[receivedroomid][receivedRound].push({
          receivedArbitreName,
          receivedWinner,
        });

        let cardsRound1 = document.querySelectorAll(
          '.card-assigned-value-round1'
        );
        let cardsRound2 = document.querySelectorAll(
          '.card-assigned-value-round2'
        );
        let cardsRound3 = document.querySelectorAll(
          '.card-assigned-value-round3'
        );

        // Check that the values object is defined before accessing its properties
        if (values) {
          console.log(
            'hey badr im values here entered ' + JSON.stringify(values)
          );

          /* console.dir(values); */

          cardsRound1.forEach((card, index) => {
            if (
              receivedroomid in values &&
              values[receivedroomid][1] &&
              values[receivedroomid][1][index]
            ) {
              const roundValue = values[receivedroomid][1][index];
              if (
                roundValue &&
                roundValue.receivedArbitreName === receivedArbitreName
              ) {
                card.innerHTML = roundValue.receivedArbitreName;
                if (roundValue.receivedWinner === 'player1') {
                  card.style.backgroundColor = 'blue';
                  card.innerText = receivedArbitreName;
                } else if (roundValue.receivedWinner === 'player2') {
                  card.style.backgroundColor = 'red';
                  card.innerText = receivedArbitreName;
                } else if (roundValue.receivedWinner === 'equal') {
                  card.style.backgroundColor = 'green';
                  card.innerText = receivedArbitreName;
                }
              }
            } else {
              console.log('this round not played yet ...... ' + receivedRound);
            }
          });

          cardsRound2.forEach((card, index) => {
            if (
              receivedroomid in values &&
              values[receivedroomid][2] &&
              values[receivedroomid][2][index]
            ) {
              const roundValue = values[receivedroomid][2][index];
              if (
                roundValue &&
                roundValue.receivedArbitreName === receivedArbitreName
              ) {
                console.log(
                  roundValue.receivedArbitreName + ' === ' + receivedArbitreName
                );
                card.innerHTML = roundValue.receivedArbitreName;
                if (roundValue.receivedWinner === 'player1') {
                  card.style.backgroundColor = 'blue';
                  card.innerText = receivedArbitreName;
                } else if (roundValue.receivedWinner === 'player2') {
                  card.style.backgroundColor = 'red';
                  card.innerText = receivedArbitreName;
                } else if (roundValue.receivedWinner === 'equal') {
                  card.style.backgroundColor = 'green';
                  card.innerText = receivedArbitreName;
                }
              }
            } else {
              console.log('this round not played yet ...... ' + receivedRound);
            }
          });

          cardsRound3.forEach((card, index) => {
            if (
              receivedroomid in values &&
              values[receivedroomid][3] &&
              values[receivedroomid][3][index]
            ) {
              const roundValue = values[receivedroomid][3][index];
              if (
                roundValue &&
                roundValue.receivedArbitreName === receivedArbitreName
              ) {
                console.log(
                  roundValue.receivedArbitreName + ' === ' + receivedArbitreName
                );
                card.innerHTML = roundValue.receivedArbitreName;
                if (roundValue.receivedWinner === 'player1') {
                  card.style.backgroundColor = 'blue';
                  card.innerText = receivedArbitreName;
                } else if (roundValue.receivedWinner === 'player2') {
                  card.style.backgroundColor = 'red';
                  card.innerText = receivedArbitreName;
                } else if (roundValue.receivedWinner === 'equal') {
                  card.style.backgroundColor = 'green';
                  card.innerText = receivedArbitreName;
                }
              }
            } else {
              console.log('this round not played yet ...... ' + receivedRound);
            }
          });
        }
      });
      function hidePopup() {
        setTimeout(function () {
          var popup = document.querySelector('.popup');
          if (popup.style.display === 'none') {
            popup.style.display = 'block';
            setTimeout(function () {
              popup.style.display = 'none';
            }, 2000);
          } else {
            popup.style.display = 'none';
          }
        }, 5000);
      }

      function showAlerted(type, round, winner) {
        let message = '';
        let backgroundColor = '';

        if (type === 'round') {
          message = `Round: ${round}`;
          backgroundColor = '#17a2b8';
        } else if (type === 'winner') {
          /* backgroundColor = '#28a745'; */
          if (winner == 'player1') {
            message = `Winner in round ${round}: Blue`;
            backgroundColor = 'blue';
          } else if (winner == 'player2') {
            message = `Winner in round ${round}: Red`;
            backgroundColor = 'Red';
          } else {
            console.log('no r win');
          }
        } else if (type === 'end') {
          if (winner == 'player1') {
            message = `Fin de match winner: Blue`;
            backgroundColor = 'blue';
          } else if (winner == 'player2') {
            message = `Fin de match winner: Red`;
            backgroundColor = 'Red';
          } else {
            message = `Fin de match egalite`;
            backgroundColor = 'green';
          }
        }

        let alertHtml = `<div class="alert alert-success popup" style="background-color: ${backgroundColor}; color: #fff;" role="alert">${message}</div>`;
        $('#alert-container').empty();
        $('#alert-container').append(alertHtml);
        if (type === 'end') {
          setTimeout(function () {
            hidePopup();
          }, 100000);
        } else {
          hidePopup();
        }
      }

      //////////////////////////////////////////////////////////////////////////////////////////////
      const round = document.getElementById('round-select').value;
      // Emit the 'request-values' event to the server when the page loads
      window.addEventListener('load', () => {
        socket.emit('request-values');
      });

      // Add event listener to the form
      document
        .getElementById('round-form')
        .addEventListener('submit', (event) => {
          event.preventDefault();
          rcount = 0;
          bcount = 0;

          // Get the selected round value
          const round = document.getElementById('round-select').value;

          // Emit the selected round value to the server
          socket.emit('select-round', round);
          const uri3 = geturu('tv');
          socket.emit('redirect-player-to-tv', uri3);
          console.log('redirect players to tv ' + uri3);

          /* showAlert(round); */
          showAlerted('round', round, '');

          console.log('alert shown');

          //////////////////////////////////
          valueCardOutPlayerBlue = 0;
          valueCardYellowPlayerBlue = 0;
          valueCardOutPlayerRed = 0;
          valueCardYellowPlayerRed = 0;
          document.getElementById(
            'incrementValuecardout_playerbleu'
          ).textContent = valueCardOutPlayerBlue;
          document.getElementById(
            'incrementValuecardyellow_playerbleu'
          ).textContent = valueCardYellowPlayerBlue;
          document.getElementById(
            'incrementValuecardout_playerred'
          ).textContent = valueCardOutPlayerRed;
          document.getElementById(
            'incrementValuecardyellow_playerred'
          ).textContent = valueCardYellowPlayerRed;
        });

      function tv() {
        console.log('clicked tv');
        socket.emit('fill-the-tv');
      }

      //get winner for rounds :
      document.getElementById('hehoclicke').addEventListener('click', () => {
        socket.emit('rounds-winner');
      });
      //listen to the winner in rounds
      socket.on('rounds-winner-result', (roundWinners) => {
        roundWinners.forEach((roundWinner, index) => {
          const roundDiv = document.getElementById(`roundwith${index + 1}`);
          if (roundDiv) {
            if (roundWinner === 'player1') {
              roundDiv.style.backgroundColor = 'blue';
            } else if (roundWinner === 'player2') {
              roundDiv.style.backgroundColor = 'red';
            } else if (roundWinner == 'equal') {
              roundDiv.style.backgroundColor = 'green';
            } else {
              return;
            }
          }
        });
      });

      /////////////////////////////////////////////////////////////////////////////////////////////////
      function geturu(tv_pl) {
        const radioGroup = document.getElementsByName('options-outlined');

        let selectedValue;

        for (let i = 0; i < radioGroup.length; i++) {
          const radioButton = radioGroup[i];
          if (radioButton.checked) {
            selectedValue = radioButton.value;
            break;
          }
        }
        const pblue1 = document.getElementById('bleuplayer').value;
        const pblue2 = document.getElementById('bleuplayerassociation').value;
        const pblue3 = document.getElementById('categories').value;
        const radiop4 = selectedValue;
        const pred1 = document.getElementById('redplayer').value;
        const pred2 = document.getElementById('redplayerassociation').value;

        const url2 = `${vurl}/${username}/${tv_pl}/${roomid}?param1=${pblue1}&param2=${pblue2}&param3=${pblue3}&param4=${radiop4}&param5=${pred1}&param6=${pred2}`;
        return url2;
      }
      //tv players redirections
      const goTvPlayers = document.getElementById('tv-player-redirection');
      goTvPlayers.addEventListener('click', () => {
        const uri2 = geturu('tvplayers');
        socket.emit('redirect-tv-to-players', uri2);

        console.log('redirect to tv players ' + uri2);
      });

      /////////////////////////////////////////////////////////////////////////////////////////////////
      // Declare a variable to store the timer value in seconds

      let timerValue = 120;

      // Declare a function to start the timer
      function startTimer() {
        // If the timer interval is already set, do nothing
        if (timerInterval) {
          return;
        }

        // Set the timer interval to decrement the timer value by 1 second every 1000 milliseconds (1 second)
        timerInterval = setInterval(() => {
          // Decrement the timer value by 1 second
          timerValue--;
          if (timerValue <= 11 && !soundPlayedAlready) {
            soundPlayedAlready = true;
            counterrsound.play();
            console.log('/sound played one');
          }
          if (timerValue <= 6 && !soundPlayedAlready2) {
            soundPlayedAlready2 = true;
            counterrsound2.play();
            console.log('/sound played two');
          }

          // If the timer value is less than or equal to 0, clear the interval and reset the timer value to 0
          if (timerValue < 1) {
            clearInterval(timerInterval);
            timerValue = 0;
            billsound.play();
            console.log('final sound');
          }

          // Update the timer element to display the current timer value in the format mm:ss
          timer.innerText = `${('0' + Math.floor(timerValue / 60)).slice(
            -2
          )}:${('0' + (timerValue % 60)).slice(-2)}`;
        }, 1000);
      }

      // Declare a function to pause the timer
      function pauseTimer() {
        counterrsound.pause();
        counterrsound2.pause();
        // If the timer interval is not set, do nothing
        if (!timerInterval) {
          return;
        }
        // Clear the timer interval
        clearInterval(timerInterval);
        // Reset the timer interval variable
        timerInterval = null;
      }

      // Declare a function to restart the timer
      function restartTimer() {
        // Clear the timer interval
        clearInterval(timerInterval);

        // Reset the timer interval variable
        timerInterval = null;

        counterrsound.pause();
        counterrsound2.pause();
        // Reset the timer value to 120 seconds
        timerValue = 120;

        // Update the timer element to display the reset timer value in the format mm:ss
        timer.innerText = `${('0' + Math.floor(timerValue / 60)).slice(-2)}:${(
          '0' +
          (timerValue % 60)
        ).slice(-2)}`;
      }

      document
        .getElementById('start-resume-button')
        .addEventListener('click', () => {
          startTimer();
          socket.emit('start-timer-admin');
        });

      document.getElementById('pause-button').addEventListener('click', () => {
        pauseTimer();
        socket.emit('pause-timer-admin');
      });

      document
        .getElementById('restart-button')
        .addEventListener('click', () => {
          restartTimer();
          socket.emit('restart-timer-admin');
        });

      /////////////////////////////////////////////////////////////////////////
      /////////////////////////////////////////////////////////////////////////

      function winnerblue() {
        showAlerted('end', '', 'player1');

        const param1 = document.getElementById('bleuplayer').value;
        console.log(param1);
        const param2 = document.getElementById('bleuplayerassociation').value;
        const param3 = document.getElementById('categories').value;

        const radioGroup = document.getElementsByName('options-outlined');

        let selectedValue;

        for (let i = 0; i < radioGroup.length; i++) {
          const radioButton = radioGroup[i];
          if (radioButton.checked) {
            selectedValue = radioButton.value;
            break;
          }
        }

        console.log(selectedValue); // logs the value of the selected radio button
        const param4 = selectedValue;
        const param5 = 'blue';

        console.log(
          param1 + ' ' + param2 + ' ' + param3 + ' ' + param4 + ' ' + param5
        );

        const url = `${vurl}/${username}/winner/${roomid}?param1=${param1}&param2=${param2}&param3=${param3}&param4=${param4}&param5=${param5}`;
        socket.emit('redirect-tv-to-winner', url);
        console.log('redirect the tv to winner');
      }

      document
        .getElementById('redirect-button-blue')
        .addEventListener('click', () => {
          winnerblue();
        });

      /////////////////////////////////////////////////////////////////////////
      /////////////////////////////////////////////////////////////////////////
      /////////////////////////////////////////////////////////////////////////

      function winnerRed() {
        /* showAlert3('red'); */
        showAlerted('end', '', 'player2');

        const param1 = document.getElementById('redplayer').value;
        const param2 = document.getElementById('redplayerassociation').value;
        const param3 = document.getElementById('categories').value;

        const radioGroup = document.getElementsByName('options-outlined');

        let selectedValue;

        for (let i = 0; i < radioGroup.length; i++) {
          const radioButton = radioGroup[i];
          if (radioButton.checked) {
            selectedValue = radioButton.value;
            break;
          }
        }

        console.log(selectedValue); // logs the value of the selected radio button

        const param4 = selectedValue;
        const param5 = 'red';

        console.log(
          param1 + ' ' + param2 + ' ' + param3 + ' ' + param4 + ' ' + param5
        );
        console.log(param1, param2, param3, radioGroup, selectedValue);

        const url = `${vurl}/${username}/winner/${roomid}?param1=${param1}&param2=${param2}&param3=${param3}&param4=${param4}&param5=${param5}`;
        socket.emit('redirect-tv-to-winner', url);
        console.log('redirect the tv to winner');
      }

      document
        .getElementById('redirect-button-red')
        .addEventListener('click', () => {
          winnerRed();
        });

      /////////////////////////////////////////////////////////////////////////
      /////////////////////////////////////////////////////////////////////////
      /////////////////////////////////////////////////////////////////////////

      document
        .getElementById('redirect-equal')
        .addEventListener('click', () => {
          const param1 = 'Egualité';
          const param2 = '-';
          const param3 = '-';
          const param4 = '-';
          const param5 = 'green';

          showAlerted('end', '', '');

          console.log(
            param1 + ' ' + param2 + ' ' + param3 + ' ' + param4 + ' ' + param5
          );

          const url = `${vurl}/${username}/winner/${roomid}?param1=${param1}&param2=${param2}&param3=${param3}&param4=${param4}&param5=${param5}`;
          socket.emit('redirect-tv-to-winner', url);
          console.log('redirect the tv to winner');
        });

      /////////////////////////////////////////////////////////////////////////////////

      // Function to increment card values for blue player
      function incrementCardValueBlue(cardType) {
        const roundnow = document.getElementById('round-select').value;
        switch (cardType) {
          case 'out':
            valueCardOutPlayerBlue++;
            if (valueCardOutPlayerBlue >= 2) {
              const divElement = document.getElementById(
                `roundwith${roundnow}`
              ); // select the div element
              const backgroundColor = divElement.style.backgroundColor; // get the background color of the div element
              if (
                backgroundColor === 'blue' ||
                backgroundColor === 'red' ||
                backgroundColor === 'green'
              ) {
                alert('change de rond ?');
                return;
              }
              // ignore the div element if its background color is blue, red, or green
              console.log('Div element ignored.');
              // Call the winnerblue function if the user confirms
              socket.emit('change-round-value', {
                player: 'player2',
                round: roundnow,
              });
              showAlerted('winner', roundnow, 'player2');
              socket.emit('out-card', 'player2');
              divElement.style.backgroundColor = 'red';
            }
            document.getElementById(
              'incrementValuecardout_playerbleu'
            ).innerText = valueCardOutPlayerBlue;
            break;

          case 'yellow':
            valueCardYellowPlayerBlue++;
            document.getElementById(
              'incrementValuecardyellow_playerbleu'
            ).innerText = valueCardYellowPlayerBlue;
            break;
          case 'blue':
            valueCardBluePlayerBlue++;
            // Check if both blue and red card values are 3 or more

            if (valueCardBluePlayerBlue >= 3) {
              // Display confirmation modal if both players have reached 3 cards
              $('#confirmation-modal .modal-body').text(
                'Êtes-vous sûr(e) de vouloir déclarer un(e) gagnant(e) ?'
              );
              $('#confirmation-modal').modal('show');

              $('#confirmation-modal .btn-confirm').click(() => {
                // Call the winnerblue function if the user confirms
                winnerRed(roundnow);
                $('#confirmation-modal').modal('hide');
              });

              $('#confirmation-modal .btn-cancel').click(() => {
                // Do nothing if the user cancels
                $('#confirmation-modal').modal('hide');
                valueCardBluePlayerBlue = 2;
                document.getElementById(
                  'incrementValuecardbleu_playerbleu'
                ).innerText = valueCardBluePlayerBlue;
              });
            }
            document.getElementById(
              'incrementValuecardbleu_playerbleu'
            ).innerText = valueCardBluePlayerBlue;
            break;
          case 'red':
            valueCardRedPlayerBlue++;
            if (valueCardRedPlayerBlue >= 3) {
              // Display confirmation modal if both players have reached 3 cards
              $('#confirmation-modal .modal-body').text(
                'Êtes-vous sûr(e) de vouloir déclarer un(e) gagnant(e) ?'
              );
              $('#confirmation-modal').modal('show');

              $('#confirmation-modal .btn-confirm').click(() => {
                // Call the winnerblue function if the user confirms
                winnerRed(roundnow);
                $('#confirmation-modal').modal('hide');
              });

              $('#confirmation-modal .btn-cancel').click(() => {
                // Do nothing if the user cancels
                $('#confirmation-modal').modal('hide');
                valueCardRedPlayerBlue = 2;
                document.getElementById(
                  'incrementValuecardred_playerbleu'
                ).innerText = valueCardRedPlayerBlue;
              });
            }
            document.getElementById(
              'incrementValuecardred_playerbleu'
            ).innerText = valueCardRedPlayerBlue;
            break;
          case 'countdown':
            valueCardCountdownPlayerBlue++;
            document.getElementById(
              'incrementValuecardcountdown_playerbleu'
            ).innerText = valueCardCountdownPlayerBlue;
            break;
          default:
            console.error('Invalid card type for blue player.');
        }
      }

      // Function to increment card values for red player
      function incrementCardValueRed(cardType) {
        const roundnow = document.getElementById('round-select').value;
        console.log(
          'Round Now : ' +
            roundnow +
            ' CardType : ' +
            cardType +
            ' Value for this card : ' +
            valueCardOutPlayerRed
        );
        switch (cardType) {
          case 'out':
            valueCardOutPlayerRed++;

            if (valueCardOutPlayerRed >= 2) {
              const divElement = document.getElementById(
                `roundwith${roundnow}`
              ); // select the div element
              const backgroundColor = divElement.style.backgroundColor; // get the background color of the div element
              if (
                backgroundColor === 'blue' ||
                backgroundColor === 'red' ||
                backgroundColor === 'green'
              ) {
                alert('change de rond ?');
                return;
              }

              showAlerted('winner', roundnow, 'player1');
              socket.emit('out-card', 'player1');
              socket.emit('change-round-value', {
                player: 'player1',
                round: roundnow,
              });
              divElement.style.backgroundColor = 'blue';
            }
            document.getElementById(
              'incrementValuecardout_playerred'
            ).innerText = valueCardOutPlayerRed;
            break;
          case 'yellow':
            valueCardYellowPlayerRed++;
            document.getElementById(
              'incrementValuecardyellow_playerred'
            ).innerText = valueCardYellowPlayerRed;
            break;
          case 'blue':
            valueCardBluePlayerRed++;
            if (valueCardBluePlayerRed >= 3) {
              // Display confirmation modal if both players have reached 3 cards
              $('#confirmation-modal .modal-body').text(
                'Êtes-vous sûr(e) de vouloir déclarer un(e) gagnant(e) ?'
              );
              $('#confirmation-modal').modal('show');

              $('#confirmation-modal .btn-confirm').click(() => {
                // Call the winnerblue function if the user confirms
                winnerblue(roundnow);
                $('#confirmation-modal').modal('hide');
              });

              $('#confirmation-modal .btn-cancel').click(() => {
                // Do nothing if the user cancels
                $('#confirmation-modal').modal('hide');
                valueCardBluePlayerRed = 2;
                document.getElementById(
                  'incrementValuecardbleu_playerred'
                ).innerText = valueCardBluePlayerRed;
              });
            }
            document.getElementById(
              'incrementValuecardbleu_playerred'
            ).innerText = valueCardBluePlayerRed;
            break;
          case 'red':
            valueCardRedPlayerRed++;
            if (valueCardRedPlayerRed >= 3) {
              // Display confirmation modal if both players have reached 3 cards
              $('#confirmation-modal .modal-body').text(
                'Êtes-vous sûr(e) de vouloir déclarer un(e) gagnant(e) ?'
              );
              $('#confirmation-modal').modal('show');

              $('#confirmation-modal .btn-confirm').click(() => {
                // Call the winnerblue function if the user confirms
                winnerblue(roundnow);
                $('#confirmation-modal').modal('hide');
              });

              $('#confirmation-modal .btn-cancel').click(() => {
                // Do nothing if the user cancels
                $('#confirmation-modal').modal('hide');
                valueCardRedPlayerRed = 2;
                document.getElementById(
                  'incrementValuecardred_playerred'
                ).innerText = valueCardRedPlayerRed;
              });
            }
            document.getElementById(
              'incrementValuecardred_playerred'
            ).innerText = valueCardRedPlayerRed;
            break;
          case 'countdown':
            valueCardCountdownPlayerRed++;
            document.getElementById(
              'incrementValuecardcountdown_playerred'
            ).innerText = valueCardCountdownPlayerRed;
            break;
          default:
            console.error('Invalid card type for red player.');
        }
      }

      /* window.addEventListener('beforeunload', function (e) {
                           e.preventDefault();
                           e.returnValue = '';
                }); */
    </script>
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-kenU1KFdBIe4zVF0s0G1M5b4hcpxyD9F7jL+jjXkk+Q2h455rYXK/7HAuoJl+0I4"
      crossorigin="anonymous"
    ></script>
    <script
      src="https://code.jquery.com/jquery-3.5.1.slim.min.js"
      integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj"
      crossorigin="anonymous"
    ></script>
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/2.9.2/umd/popper.min.js"
      integrity="sha512-2rNj2KJ+D8s1ceNasTIex6z4HWyOnEYLVC3FigGOmyQCZc2eBXKgOxQmo3oKLHyfcj53uz4QMsRCWNbLd32Q1g=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    ></script>
    <script
      src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/js/bootstrap.min.js"
      integrity="sha384-OgVRvuATP1z7JjHLkuOU7Xw704+h835Lr+6QL9UvYjZE3Ipu6Tp75j7Bh/kR0JKI"
      crossorigin="anonymous"
    ></script>
  </body>
</html>
